Youâ€™re my coding assistant for the â€œSISLÂ VFD Stock Reportâ€ generator.

ğŸ—‚ï¸Â Repo structure (local path):
  â”œâ”€ data/
  â”‚   â”œâ”€ VFD_PRICE_LAST.csv            # inventory  (QtyÂ owned,Â TotalÂ cost)
  â”‚   â”œâ”€ VFD_PRICE_JULY_2025.csv       # 1.27 price list (â€œ1.27â€ column)
  â”‚   â””â”€ VFD_Price_SISL_Final.csv      # master listâ€‘price map
  â”œâ”€ build_vfd_report.py  â† current script
  â””â”€ pdf_reports/          â† PDF output folder

ğŸ¯Â Report requirements
1. Exclude rows with QtyÂ =Â 0, and models **â€œFRâ€‘S520SEâ€‘0.2Kâ€‘19â€** or any model containing **â€œPECâ€**.
2. Compute for each model:  
   â€¢Â COGS,Â COGSÃ—1.75â€ƒâ€¢Â ListÂ Priceâ€ƒâ€¢Â 1.27 priceâ€ƒâ€¢Â 20â€¯/â€¯25â€¯/â€¯30â€¯% discountsâ€ƒâ€¢Â GPâ€¯%.
3. Sort by capacity (0.4â€¯KÂ â†’Â 400â€¯K) **then** by series in the exact order **D,â€¯E,â€¯F,â€¯A,â€¯HEL**.
4. Output an A4â€‘portrait PDF (0.6â€³ margins) intoÂ `pdf_reports/`  
   â€“ filename pattern:Â `SISL_VFD_PL_<YYMMDD>_V.<nn>.pdf`  
   â€“ autoâ€‘increment the version *nn* for each run.
5. Header: â€œVFDÂ STOCK LISTâ€, todayâ€™s date, company â€œSmartÂ IndustrialÂ SolutionÂ Ltd.â€  
6. Table columns (mm widths):  
   SLÂ 8,Â ModelÂ 34,Â QtyÂ 8,Â ListÂ PriceÂ 17,Â 20â€¯%Â DiscÂ 17,Â 25â€¯%Â DiscÂ 17,Â 30â€¯%Â DiscÂ 17,Â GPâ€¯%Â 11,Â COGSÂ 17,Â COGSÃ—1.75Â 18,Â 1.27Â 17

ğŸ“Â Series & capacity helpers (inÂ code):
def series_tag(model):
    if re.search(r"FR-HEL", model, re.I): return "H"
    m = re.match(r"FR-([A-Z])", model)
    return m.group(1) if m else ""

order_map = {"D":0, "E":1, "F":2, "A":3, "H":4}

def capacity_val(model):
    m = re.search(r"-(?:H)?([\d.]+)K", model)
    return float(m.group(1)) if m else 0.0

ğŸ”§Â Listâ€‘price lookup logic:
1Â Exact match            â†’ use it  
2Â Special D/Eâ‡†A fallback  â†’ 720Â /Â 740 families  
3Â Generic crossâ€‘series fallback (Aâ‡†Eâ‡†Fâ‡†D) for same family/capacity  

ğŸ“„Â Known quirks
â€“ Inventory â€œNameâ€ vs â€œModelâ€ column; script normalises.  
â€“ `FRâ€‘D720Sâ€‘025â€‘NA` renames to `FRâ€‘D720Sâ€‘0.4K`.  
â€“ Some list prices truly absent; fallback now fills most.

âœ…Â `build_vfd_report.py` (v0.5) already implements everything.